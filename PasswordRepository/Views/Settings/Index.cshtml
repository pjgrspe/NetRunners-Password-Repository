@model PasswordRepository.Models.PasswordEntryModel
@using PasswordRepository.Helpers;
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>

<html lang="en">
<head>
    <title>Home</title>
    <link href="~/Style/StyleSheetButtonEditTrash.css" rel="stylesheet">
    <link href="~/Style/StyleSheetDashboard.css" rel="stylesheet">
</head>
<body>
    @Html.Partial("_NavbarDashboard")
    <div id="outer">
        <!--Content-->
        <section class="text-light p-5">
            <div class="container d-flex justify-content-center" id="maincontainer">
                <div class="justify-content-center col-12" id="content">
                    <!--Title-->
                    <div class="d-flex justify-content-center col-12" id="title" style="display:block; white-space:nowrap; margin-left:auto; margin-right:auto;">
                        <h2 align="center">
                            / SETTINGS /
                        </h2>
                    </div>
                    <!--TABLE-->
                    <div class="d-flex justify-content-center" style="margin-top:20px">
                        <div class="row w-75" id="passrepotable">
                            <!--ITEM DETAILS-->
                            <div class="col-8" id="table-rightcolumn">
                                <div class="tab-content" id="nav-tabContent">
                                    @{foreach (var PassEntry in Model.Passwords.Where(x => x.UID.Equals((int)Session["ID"]) && x.isTrashed.Equals(false) && x.isActive.Equals(true)))
                                        {
                                            //using (@Html.BeginForm("Index", "Login", FormMethod.Post)) { };
                                            var decryptedPassword = Encrypter.DecryptString(PassEntry.PR_PASSWORD);
                                            <!--ITEM 1 DETAILS-->
                                            <div class="tab-pane show" id="list-@PassEntry.PID" role="tabpanel" aria-labelledby="list-@PassEntry.PID-list">
                                                <div class="container">
                                                    <!--TITLE NAME-->
                                                    <div class="mt-3 item-table w-100 table-form-title" style="margin-top:-30px">
                                                        <div class="tbl-details">
                                                            <h2>
                                                                <input type="text" maxlength="20" readonly style="width:100%" class="form-control-title" id="Title-@PassEntry.PID.ToString()" value="@PassEntry.PR_TITLE" spellcheck="false">
                                                            </h2>
                                                        </div>
                                                        <!--USERNAME INPUT-->
                                                        <div class="mt-3 tbl-details">
                                                            <div class="form-floating table-form">
                                                                <p style="margin-bottom:-2px;">Username</p>
                                                                <input type="text" maxlength="50" readonly class="form-control-plaintext readonly" style="width:100%" id="Username-@PassEntry.PID.ToString()" value="@PassEntry.PR_USERNAME" spellcheck="false">
                                                                @*@Html.TextBoxFor(Model => Model.textbox_PR_USERNAME, new { @class = "form-control-plaintext", id = "Username-" + PassEntry.PID.ToString(), type = "text", @readonly = "readonly", Value = PassEntry.PR_USERNAME, style = "width:100%" })*@
                                                                <span>
                                                                    <!--CC icon-->
                                                                    <img src="~/Elements/copytoclipboard.svg" class="ccicon-@PassEntry.PID" id="cciconUsername-@PassEntry.PID.ToString()" />
                                                                </span>
                                                                <script type="text/javascript">
                                                                // Wrap your code inside a function
                                                                function initializeCCIcon() {
                                                                    let ccicon = document.getElementById('cciconUsername-@PassEntry.PID.ToString()');
                                                                    var formdisplay = document.getElementById('Username-@PassEntry.PID.ToString()');

                                                                    // Make sure the elements are not null before accessing their properties
                                                                    if (ccicon && formdisplay) {

                                                                        ccicon.style.display = "none";

                                                                        formdisplay.addEventListener("mouseenter", function () {
                                                                            ccicon.style.display = "block";
                                                                            formdisplay.classlist.add("hover");
                                                                            //ccicon.classList.add = "hidden";

                                                                        });

                                                                        formdisplay.addEventListener("mouseleave", function () {
                                                                        const isTargetIcon = event.relatedTarget === ccicon || ccicon.contains(event.relatedTarget);
                                                                            if (!isTargetIcon) {
                                                                                ccicon.style.display = "none";
                                                                            }
                                                                        });

                                                                        ccicon.addEventListener("mouseenter", function () {
                                                                            formdisplay.classList.add("hover");
                                                                        });

                                                                        ccicon.addEventListener("mousedown", function (event) {
                                                                            event.preventDefault(); // prevent default action to avoid losing focus
                                                                            togglecc_table();
                                                                        });

                                                                         function togglecc_table() {
                                                                            var copyText = formdisplay

                                                                            // Copy the text inside the text field
                                                                            navigator.clipboard.writeText(copyText.value);

                                                                            // Alert the copied text
                                                                            alert("Copied the text: " + copyText.value);
                                                                            ccicon.style.display = "none";
                                                                        }
                                                                    }
                                                                }
                                                                  // Call the function after the document has finished loading
                                                                window.addEventListener('load', initializeCCIcon);
                                                                </script>
                                                            </div>
                                                        </div>
                                                        <!--EMAIL INPUT-->
                                                        <div class="mt-3 tbl-details">
                                                            <div class="form-floating table-form">
                                                                <p style="margin-bottom:-2px;">Email</p>
                                                                <input type="email" readonly class="form-control-plaintext" style="width:100%" id="Email-@PassEntry.PID.ToString()" value="@PassEntry.PR_EMAIL" spellcheck="false">
                                                                @*@Html.TextBoxFor(Model => Model.textbox_PR_EMAIL, new { @class = "form-control-plaintext", id = "Email-" + PassEntry.PID.ToString(), type = "text", @readonly = "readonly", Value = @PassEntry.PR_EMAIL, style = "width:100%" })*@
                                                                <span>
                                                                    <!--CC icon-->
                                                                    <img src="~/Elements/copytoclipboard.svg" class="ccicon-@PassEntry.PID" id="cciconEmail-@PassEntry.PID" />
                                                                </span>
                                                                <script type="text/javascript">
                                                                // Wrap your code inside a function
                                                                function initializeCCIcon() {
                                                                    let ccicon = document.getElementById('cciconEmail-@PassEntry.PID.ToString()');
                                                                    var formdisplay = document.getElementById('Email-@PassEntry.PID.ToString()');

                                                                    // Make sure the elements are not null before accessing their properties
                                                                    if (ccicon && formdisplay) {

                                                                        ccicon.style.display = "none";

                                                                        formdisplay.addEventListener("mouseenter", function () {
                                                                            ccicon.style.display = "block";
                                                                            formdisplay.classlist.add("hover");
                                                                            //ccicon.classList.add = "hidden";

                                                                        });

                                                                        formdisplay.addEventListener("mouseleave", function () {
                                                                        const isTargetIcon = event.relatedTarget === ccicon || ccicon.contains(event.relatedTarget);
                                                                            if (!isTargetIcon) {
                                                                                ccicon.style.display = "none";
                                                                            }
                                                                        });

                                                                        ccicon.addEventListener("mouseenter", function () {
                                                                            formdisplay.classList.add("hover");
                                                                        });

                                                                        ccicon.addEventListener("mousedown", function (event) {
                                                                            event.preventDefault(); // prevent default action to avoid losing focus
                                                                            togglecc_table();
                                                                        });

                                                                         function togglecc_table() {
                                                                            var copyText = formdisplay

                                                                            // Copy the text inside the text field
                                                                            navigator.clipboard.writeText(copyText.value);

                                                                            // Alert the copied text
                                                                            alert("Copied the text: " + copyText.value);
                                                                            ccicon.style.display = "none";
                                                                        }
                                                                    }
                                                                }
                                                                  // Call the function after the document has finished loading
                                                                  window.addEventListener('load', initializeCCIcon);
                                                                </script>
                                                            </div>
                                                        </div>
                                                        <!--PASSWORD INPUT-->
                                                        <div class="mt-3 tbl-details">
                                                            <div class="form-floating table-form">
                                                                <p style="margin-bottom:-2px;">Password</p>
                                                                <input type="password" readonly class="form-control-plaintext" style="width:100%" id="Password-@PassEntry.PID.ToString()" value="@decryptedPassword" spellcheck="false">
                                                                @*@Html.PasswordFor(Model => Model.textbox_PR_PASSWORD, new { @class = "form-control-plaintext", id = "Password-" + PassEntry.PID.ToString(), type = "password", required = "required", @readonly = "readonly", Value = @decryptedPassword, style = "width:100%" })*@
                                                                <span>
                                                                    <!--Eye and CC icon-->
                                                                    <img src="~/Elements/eye-white.svg" class="eyeiconpassword-@PassEntry.PID" id="eyeiconPassword-@PassEntry.PID" />
                                                                    <img src="~/Elements/copytoclipboard.svg" class="cciconpassword-@PassEntry.PID" id="cciconPassword-@PassEntry.PID" />
                                                                </span>
                                                                <script type="text/javascript">
                                                                // Wrap your code inside a function
                                                                function initializeCCIcon() {
                                                                    let eyeicontbl = document.getElementById('eyeiconPassword-@PassEntry.PID.ToString()');
                                                                    let ccicon = document.getElementById('cciconPassword-@PassEntry.PID.ToString()');
                                                                    var formdisplay = document.getElementById('Password-@PassEntry.PID.ToString()');

                                                                    // Make sure the elements are not null before accessing their properties
                                                                    if (ccicon && formdisplay && eyeicontbl) {

                                                                    eyeicontbl.style.display = "block";
                                                                    ccicon.style.display = "none";

                                                                    formdisplay.addEventListener("mouseenter", function () {
                                                                        ccicon.style.display = "block";
                                                                        formdisplay.classList.add("hover");
                                                                    });

                                                                    formdisplay.addEventListener("mouseleave", function () {
                                                                        const isTargetIcon = event.relatedTarget === ccicon || ccicon.contains(event.relatedTarget);

                                                                        if (!isTargetIcon) {
                                                                            ccicon.style.display = "none";
                                                                        }
                                                                    });

                                                                    eyeicontbl.addEventListener("mouseenter", function () {
                                                                        formdisplay.classList.add("hover");
                                                                    });

                                                                    ccicon.addEventListener("mouseenter", function () {
                                                                        formdisplay.classList.add("hover");
                                                                    });

                                                                    eyeicontbl.addEventListener("mousedown", function (event) {
                                                                        event.preventDefault(); // prevent default action to avoid losing focus
                                                                        toggleshowPW_table();
                                                                    });

                                                                    ccicon.addEventListener("mousedown", function (event) {
                                                                        event.preventDefault(); // prevent default action to avoid losing focus
                                                                        togglecc_table();
                                                                    });

                                                                    function togglecc_table() {
                                                                        var copyText = formdisplay

                                                                        // Copy the text inside the text field
                                                                        navigator.clipboard.writeText(copyText.value);

                                                                        // Alert the copied text
                                                                        alert("Copied the text: " + copyText.value);
                                                                        ccicon.style.display = "none";
                                                                    }

                                                                    function toggleshowPW_table() {
                                                                        var show = document.getElementById('Password-@PassEntry.PID.ToString()');
                                                                        if (show.type == 'password') {
                                                                            show.type = 'text';
                                                                            eyeicontbl.src = "/Elements/eye-slash-white.svg"
                                                                        }
                                                                        else {
                                                                            show.type = 'password'
                                                                            eyeicontbl.src = "/Elements/eye-white.svg"

                                                                        }
                                                                        show.focus();
                                                                        }
                                                                    }

                                                                }
                                                                // Call the function after the document has finished loading
                                                                window.addEventListener('load', initializeCCIcon);
                                                                </script>
                                                            </div>
                                                        </div>
                                                        <!--URL INPUT-->
                                                        <div class="mt-3 tbl-details">
                                                            <div class="form-floating table-form">
                                                                <p style="margin-bottom:-2px;">URL</p>
                                                                <input type="text" readonly class="form-control-plaintext" style="width:100%" id="URL-@PassEntry.PID.ToString()" value="@PassEntry.PR_URL" spellcheck="false">
                                                                @*@Html.TextBoxFor(Model => Model.textbox_PR_URL, new { @class = "form-control-plaintext", id = "URL-" + PassEntry.PID.ToString(), type = "text", @readonly = "readonly", Value = @PassEntry.PR_URL, style = "width:100%" })*@
                                                                <span>
                                                                    <!--CC icon-->
                                                                    <img src="~/Elements/copytoclipboard.svg" class="ccicon-@PassEntry.PID" id="cciconURL-@PassEntry.PID" />
                                                                </span>
                                                                <script type="text/javascript">
                                                                // Wrap your code inside a function
                                                                function initializeCCIcon() {
                                                                    let ccicon = document.getElementById('cciconURL-@PassEntry.PID.ToString()');
                                                                    var formdisplay = document.getElementById('URL-@PassEntry.PID.ToString()');

                                                                    // Make sure the elements are not null before accessing their properties
                                                                    if (ccicon && formdisplay) {

                                                                        ccicon.style.display = "none";

                                                                        formdisplay.addEventListener("mouseenter", function () {
                                                                            ccicon.style.display = "block";
                                                                            formdisplay.classlist.add("hover");
                                                                            //ccicon.classList.add = "hidden";

                                                                        });

                                                                        formdisplay.addEventListener("mouseleave", function () {
                                                                        const isTargetIcon = event.relatedTarget === ccicon || ccicon.contains(event.relatedTarget);
                                                                            if (!isTargetIcon) {
                                                                                ccicon.style.display = "none";
                                                                            }
                                                                        });

                                                                        ccicon.addEventListener("mouseenter", function () {
                                                                            formdisplay.classList.add("hover");
                                                                        });

                                                                        ccicon.addEventListener("mousedown", function (event) {
                                                                            event.preventDefault(); // prevent default action to avoid losing focus
                                                                            togglecc_table();
                                                                        });

                                                                         function togglecc_table() {
                                                                            var copyText = formdisplay

                                                                            // Copy the text inside the text field
                                                                            navigator.clipboard.writeText(copyText.value);

                                                                            // Alert the copied text
                                                                            alert("Copied the text: " + copyText.value);
                                                                            ccicon.style.display = "none";
                                                                        }
                                                                    }
                                                                }
                                                                  // Call the function after the document has finished loading
                                                                  window.addEventListener('load', initializeCCIcon);
                                                                </script>
                                                            </div>
                                                        </div>
                                                        <!--NOTES INPUT-->
                                                        <div class="mt-3 tbl-details">
                                                            <div class="form-floating table-form">
                                                                <p style="margin-bottom:-2px;">Notes</p>
                                                                <textarea type="text" style="text-align: left; height: 100px; width: 100%" readonly class="form-control-plaintext form-control-notes" id=Notes-@PassEntry.PID.ToString() spellcheck="false">@PassEntry.PR_NOTES</textarea>
                                                                @*@Html.TextAreaFor(Model => Model.textbox_PR_NOTES, new { @class = "form-control-plaintext form-control-notes", id = "Notes-"+@PassEntry.PID.ToString(), @readonly = "readonly", type = "text", Value = @PassEntry.PR_NOTES, style = "width:100%; text-align: left; height: 100px;" })*@
                                                                <span>
                                                                    <!--CC icon-->
                                                                    <img src="~/Elements/copytoclipboard.svg" class="cciconnotes-@PassEntry.PID" id="cciconNotes-@PassEntry.PID" />
                                                                </span>
                                                                <script type="text/javascript">
                                                                // Wrap your code inside a function
                                                                function initializeCCIcon() {
                                                                    let ccicon = document.getElementById('cciconNotes-@PassEntry.PID.ToString()');
                                                                    var formdisplay = document.getElementById('Notes-@PassEntry.PID.ToString()');

                                                                    // Make sure the elements are not null before accessing their properties
                                                                    if (ccicon && formdisplay) {

                                                                        ccicon.style.display = "none";

                                                                        formdisplay.addEventListener("mouseenter", function () {
                                                                            ccicon.style.display = "block";
                                                                            formdisplay.classlist.add("hover");
                                                                            //ccicon.classList.add = "hidden";

                                                                        });

                                                                        formdisplay.addEventListener("mouseleave", function () {
                                                                        const isTargetIcon = event.relatedTarget === ccicon || ccicon.contains(event.relatedTarget);
                                                                            if (!isTargetIcon) {
                                                                                ccicon.style.display = "none";
                                                                            }
                                                                        });

                                                                        ccicon.addEventListener("mouseenter", function () {
                                                                            formdisplay.classList.add("hover");
                                                                        });

                                                                        ccicon.addEventListener("mousedown", function (event) {
                                                                            event.preventDefault(); // prevent default action to avoid losing focus
                                                                            togglecc_table();
                                                                        });

                                                                         function togglecc_table() {
                                                                            var copyText = formdisplay

                                                                            // Copy the text inside the text field
                                                                            navigator.clipboard.writeText(copyText.value);

                                                                            // Alert the copied text
                                                                            alert("Copied the text: " + copyText.value);
                                                                            ccicon.style.display = "none";
                                                                        }
                                                                    }
                                                                }
                                                                  // Call the function after the document has finished loading
                                                                  window.addEventListener('load', initializeCCIcon);
                                                                </script>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!--DATE INPUT-->
                                                    <div class="col-12 d-flex justify-content-center" style="display:none;">
                                                        <div class="mt-4" style="color:gray; margin-right:60px;" id="dateinfo-@PassEntry.PID">
                                                            <p>Created on @PassEntry.ENTRY_CREATED</p>
                                                        </div>
                                                    </div>
                                                    <div class="col-12 d-flex justify-content-center" style="margin-right:60px;">
                                                        <div class="mt-4 mb-4" style="color:gray; margin-right:60px; display:none;" id="editbtns-@PassEntry.PID">
                                                            <button class="btn btn-outline-secondary rounded-0" onclick="updateEntry('@PassEntry.PID','@PassEntry.PID.ToString()')" style="margin-right:8px;" aria-pressed="true" id="editacceptbtn">
                                                                CONFIRM
                                                            </button>
                                                            <button class="btn btn-outline-secondary rounded-0" onclick="toggleEdit('@PassEntry.PID'); resetform('@PassEntry.PID','@PassEntry.PR_TITLE','@PassEntry.PR_USERNAME','@PassEntry.PR_EMAIL','@decryptedPassword','@PassEntry.PR_URL','@PassEntry.PR_NOTES')" aria-pressed="true" id="editcancelbtn">
                                                                CANCEL
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <nav class="menu" id="edit-menu-@PassEntry.PID">
                                                    <input type="checkbox" href="#" class="menu-open" name="menu-open" id="menu-open-@PassEntry.PID.ToString()" />
                                                    <label class="menu-open-button" for="menu-open-@PassEntry.PID.ToString()">
                                                        <span class="lines line-1"></span>
                                                        <span class="lines line-2"></span>
                                                        <span class="lines line-3"></span>
                                                    </label>
                                                    <!--LUIS-->
                                                    <a class="menu-item red" onclick="deleteEntry('@PassEntry.PID')"> <i class="fa fa-trash"></i> </a>
                                                    <a class="menu-item green" onclick="toggleEdit('@PassEntry.PID')"> <i class="fa fa-pen"></i> </a>
                                                    @*<a class="menu-item green" onclick="updateEntry('@PassEntry.PID','@PassEntry.PID.ToString()')"> <i class="fa fa-pen"></i> </a>*@<a class="menu-item green" onclick="updateEntry('@PassEntry.PID','@PassEntry.PID.ToString()')"><i class="fa fa-pen"></i></a><a class="menu-item green" onclick="updateEntry('@PassEntry.PID','@PassEntry.PID.ToString()')"><i class="fa fa-pen"></i></a>
                                                </nav>

                                            </div>

                                        }
                                    }
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>
</html>

<script type="text/javascript">
    function resetform(PID, Title, Username, Email, Password, URL, Notes) {
        document.getElementById('Title-' + PID).value = Title;
        document.getElementById('Username-' + PID).value = Username;
        document.getElementById('Email-' + PID).value = Email;
        document.getElementById('Password-' + PID).value = Password;
        document.getElementById('URL-' + PID).value = URL;
        document.getElementById('Notes-' + PID).value = Notes;
    }

    function toggleEdit(PID) {
    var itemTITLE = document.getElementById('Title-' + PID);
    var itemUN = document.getElementById('Username-' + PID);
    var itemPW = document.getElementById('Password-' + PID);
    var itemEMAIL = document.getElementById('Email-' + PID);
    var itemURL = document.getElementById('URL-' + PID);
    var itemNOTES = document.getElementById('Notes-' + PID);
    var editicon = document.getElementById('edit-menu-' + PID);
    var editbtns = document.getElementById('editbtns-' + PID);
    var dateinfo = document.getElementById('dateinfo-' + PID);
    //toggle
    if (itemUN.classList == 'form-control-plaintext readonly') {
        //REMOVE MENU ICONS
        editicon.style.display = "none";
        dateinfo.style.display = "none";
        //ADD CONFIRM AND CANCEL BUTTONS
        editbtns.style.display = "block";
        //ITEM TITLE
        itemTITLE.readOnly = false;
        itemTITLE.className = "form-control-edit";
        //ITEM UN
        itemUN.readOnly = false;
        itemUN.className = "form-control-edit";
        //ITEM PW
        itemPW.readOnly=false;
        itemPW.className = "form-control-edit";
        itemPW.type = 'password';
        //ITEM EMAIL
        itemEMAIL.readOnly = false;
        itemEMAIL.className = "form-control-edit";
        //ITEM URL
        itemURL.readOnly = false;
        itemURL.className = "form-control-edit";
        //ITEM NOTES
        itemNOTES.readOnly = false;
        itemNOTES.className = "form-control-notes-edit form-control-edit";
    }
    else {
        //ADD MENU ICONS
        editicon.style.display = "block";
        dateinfo.style.display = "block";
        //REMOVE CONFIRM AND CANCEL BUTTONS
        editbtns.style.display = "none";
        //ITEM TITLE
        itemTITLE.readOnly = true;
        itemTITLE.className = "form-control-plaintext form-control-title";
        //ITEM UN
        itemUN.readOnly = true;
        itemUN.className = "form-control-plaintext readonly";
        //ITEM PW
        itemPW.readOnly = true;
        itemPW.className = "form-control-plaintext";
        itemPW.type = 'password';
        //ITEM EMAIL
        itemEMAIL.readOnly = true;
        itemEMAIL.className = "form-control-plaintext";
        //itemEMAIL.value = Email;
        //ITEM URL
        itemURL.readOnly = true;
        itemURL.className = "form-control-plaintext";
        //ITEM NOTES
        itemNOTES.readOnly = true;
        itemNOTES.className = "form-control-plaintext form-control-notes";
    }
}
</script>

<!--LUIS-->
<script type="text/javascript">

    //Function for deleting given entry
    function deleteEntry(passwordID) {

        //Confirmation message before deleting entry
        if (confirm("Are you sure you want to delete this entry?")) {

            //Packages the received variable
            var data = {
                passwordID: passwordID
            }

            //Ajax function to prepare data to be sent to the controller
            $.ajax({
                type: "POST",
                url: "/Dashboard/DeleteEntry",
                dataType: "JSON",
                data: JSON.stringify(data),
                contentType: 'application/json; charset=utf8',
                success: function (res) {
                    alert(res.msg)
                    location.reload(true);
                },
                error: function () {
                    alert("An error occurred (Javascript)")
                }
            })

        }

    }

    //Function for updating given entry
    function updateEntry(passwordID, passwordIDstring) {

        //Sets variables to corresponding textboxes
        var pwID = passwordID;
        var pwTitle = $('#Title-' + passwordIDstring).val();
        var pwEmail = $('#Email-' + passwordIDstring).val();
        var pwUname = $('#Username-' + passwordIDstring).val();
        var pwPassword = $('#Password-' + passwordIDstring).val();
        var pwUrl = $('#URL-' + passwordIDstring).val();
        var pwNotes = $('#Notes-' + passwordIDstring).val()

        //Packages the variables
        var data = {
            passwordID: pwID,
            passwordTitle: pwTitle,
            passwordEmail: pwEmail,
            passwordUname: pwUname,
            passwordPassword: pwPassword,
            passwordURL: pwUrl,
            passwordNotes: pwNotes
        }

        //Ajax function to prepare data to be sent to the controller
        $.ajax({
            type: "POST",
            url: "/Dashboard/UpdateEntry",
            dataType: "JSON",
            data: JSON.stringify(data),
            contentType: 'application/json; charset=utf8',
            success: function (res) {
                alert(res.msg)
                location.reload(true);
            },
            error: function () {
                alert("An error occurred")
            }
        })
    }

</script>
